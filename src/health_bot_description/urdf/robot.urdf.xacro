<?xml version="1.0"?>
<robot name="health_bot" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- 1. PHYSICAL DIMENSIONS (Defined First) -->
    <xacro:property name="a" value="0.6" /> <!-- Length (X) -->
    <xacro:property name="b" value="0.4" /> <!-- Width (Y) -->
    <xacro:property name="c" value="0.3" /> <!-- Height (Z) -->
    
    <!-- WHEEL DIMENSIONS -->
    <xacro:property name="r" value="0.1" />  <!-- Drive Wheel Radius -->
    <xacro:property name="d" value="0.05" /> <!-- Drive Wheel Width -->
    <xacro:property name="cr" value="0.1" /> <!-- Caster Radius -->

    <!-- 2. CALCULATED OFFSETS (Defined Second) -->
    <!-- <xacro:property name="chassis_z_offset" value="${(c/2) + r}" /> -->
    <xacro:property name="wheel_y_offset" value="${(b/2) + (d/2)}" />
    <!-- <xacro:property name="wheel_x_offset" value="0.15" /> -->

    <!-- 3. INCLUDE EXTERNAL FILES (Now they can see the variables above) -->
    <xacro:include filename="inertials.xacro" />
    <xacro:include filename="robot.gazebo" />

    <!-- 4. ROBOT STRUCTURE -->
    <link name="base_footprint"></link>

    <joint name="base_joint" type="fixed">
        <parent link="base_footprint" />
        <child link="body_link" />
        <origin xyz="0 0 ${r}" rpy="0 0 0" />
    </joint>

    <link name="body_link">
        <visual>
            <origin xyz="0 0 ${c/2}" rpy="0 0 0" />
            <geometry> <box size="${a} ${b} ${c}" /> </geometry>
        </visual>
        <collision>
            <origin xyz="0 0 ${c/2}" rpy="0 0 0" />
            <geometry> <box size="${a} ${b} ${c}" /> </geometry>
        </collision>
        <xacro:inertial_body />
    </link>

    <!-- WHEEL MACRO -->
    <xacro:macro name="m_wheel" params="prefix y_reflect">
        <joint name="${prefix}_wheel_joint" type="continuous">
            <parent link="body_link" />
            <child link="${prefix}_wheel_link" />
            <origin xyz="-0.15 ${y_reflect * wheel_y_offset} 0" rpy="0 0 0" />
            <axis xyz="0 1 0" />
        </joint>
        <link name="${prefix}_wheel_link">
            <visual>
                <origin rpy="${pi/2} 0 0" xyz="0 0 0" />
                <geometry> <cylinder radius="${r}" length="${d}" /> </geometry>
            </visual>
            <collision>
                <origin rpy="${pi/2} 0 0" xyz="0 0 0" />
                <geometry> <cylinder radius="${r}" length="${d}" /> </geometry>
            </collision>
            <xacro:inertial_wheel />
        </link>
    </xacro:macro>
    <xacro:m_wheel prefix="right" y_reflect="-1" />
    <xacro:m_wheel prefix="left" y_reflect="1" />

    <!-- CASTER WHEEL (FRONT) -->
    <joint name="caster_joint" type="fixed">
        <parent link="body_link" />
        <child link="caster_link" />
        <origin xyz="0.2 0 0" rpy="0 0 0" />
    </joint>

    <link name="caster_link">
        <visual>
            <geometry> <sphere radius="${cr}" /> </geometry>
        </visual>
        <collision>
            <geometry> <sphere radius="${cr}" /> </geometry>
        </collision>
        <xacro:inertial_caster />
    </link>

</robot>
